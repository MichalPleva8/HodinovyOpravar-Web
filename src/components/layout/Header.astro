---
// src/components/layout/Header.astro
import { Phone, Menu, X, Mail, MapPin, Facebook, Instagram, Linkedin } from 'lucide-react'
import TopBar from './TopBar.astro'
import Button from '../ui/Button.astro'
import { socials } from '../../data/socials'
import { navigation } from '../../data/navigation'
import { contact } from '../../data/contact'

const socialIcons = {
	facebook: Facebook,
	twitter: Facebook,
	instagram: Instagram,
	youtube: Facebook,
	linkedin: Linkedin,
}

const currentPath = Astro.url.pathname
---

<>
	<TopBar />
	<div class="main-nav z-50 border-b border-neutral-300 bg-white">
		<nav class="container mx-auto px-6 py-2">
			<div class="flex items-center justify-between gap-8">
				<!-- Logo -->
				<a
					href="/"
					class="flex items-center transition-all duration-300 ease-out hover:-translate-y-0.5"
				>
					<img
						src="/images/logo.png"
						alt="Hodinový opravár"
						id="header-logo"
						class="h-12 transition-all duration-300 ease-out lg:h-[62px]"
					/>
				</a>

				<!-- Desktop Navigation + CTA -->
				<div class="hidden items-center gap-8 py-2 lg:flex">
					<!-- Navigation Links -->
					<ul class="flex items-center gap-8">
						{
							navigation.map((item) => (
								<li>
									<a
										href={item.href}
										class={`text-body font-medium transition-colors ${
											currentPath === item.href
												? 'text-primary font-bold'
												: 'hover:text-primary text-neutral-700'
										}`}
									>
										{item.name}
									</a>
								</li>
							))
						}
					</ul>

					<!-- CTA Button -->
					<Button href={`tel:${contact.phone}`} variant="primary" size="sm" class="gap-2">
						<Phone className="h-5 w-5" />
						Zavolať teraz
					</Button>
				</div>

				<!-- Mobile Menu Button -->
				<button
					class="hover:text-primary p-2 text-neutral-700 transition-colors lg:hidden"
					aria-label="Otvoriť menu"
					id="mobile-menu-button"
				>
					<div class="relative h-6 w-6">
						<Menu className="menu-icon absolute inset-0 h-6 w-6 transition-all duration-300" />
						<X className="close-icon absolute inset-0 h-6 w-6 -rotate-90 scale-0 opacity-0 transition-all duration-300" />
					</div>
				</button>
			</div>
		</nav>
	</div>

	<!-- Mobile Navigation Overlay (below header) -->
	<div
		id="mobile-menu"
		class="mobile-menu-overlay fixed right-0 left-0 z-40 bg-white transition-transform duration-300 ease-in-out lg:hidden"
		style="transform: translateY(-100%); top: var(--header-height, 72px); height: calc(100vh - var(--header-height, 72px));"
	>
		<div class="flex h-full flex-col justify-between overflow-y-auto px-6 pt-8 pb-12">
			<ul class="flex flex-col space-y-2">
				{
					navigation.map((item) => (
						<li>
							<a
								href={item.href}
								class={`text-body block rounded-lg px-4 py-2 font-medium transition-colors ${
									currentPath === item.href
										? 'bg-primary-light text-primary font-bold'
										: 'text-neutral-700 hover:bg-neutral-200'
								}`}
							>
								{item.name}
							</a>
						</li>
					))
				}
			</ul>

			<div>
				<!-- Social Links -->
				<div class="flex items-center justify-center gap-4">
					{
						socials.map((social) => {
							const Icon = socialIcons[social.icon]
							return (
								<a
									href={social.url}
									target="_blank"
									rel="noopener noreferrer"
									aria-label={social.name}
									class="group hover:bg-primary flex h-10 w-10 items-center justify-center rounded-full bg-neutral-100 transition-all"
								>
									<Icon className="h-5 w-5 text-primary transition-colors group-hover:text-white" />
								</a>
							)
						})
					}
				</div>

				<!-- Mobile CTA Button -->
				<div class="mt-6">
					<Button
						href={`tel:${contact.phone}`}
						variant="primary"
						size="md"
						class="w-full gap-2"
					>
						<Phone className="h-5 w-5" />
						Zavolať teraz
					</Button>
				</div>
			</div>
		</div>
	</div>
</>

<style>
	/* Mobile: Fixed positioning */
	.main-nav {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
	}

	/* Desktop: Sticky positioning */
	@media (min-width: 1024px) {
		.main-nav {
			position: sticky;
			top: 0;
			left: auto;
			right: auto;
		}
	}

	/* Mobile menu subtle spread shadow */
	.mobile-menu-overlay {
		box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08);
	}
</style>

<script>
	// Mobile menu toggle with slide animation
	document.addEventListener('DOMContentLoaded', () => {
		const menuButton = document.getElementById('mobile-menu-button')
		const mobileMenu = document.getElementById('mobile-menu')
		const mainNav = document.querySelector('.main-nav')

		// Set CSS variable for header height
		if (mainNav && mobileMenu) {
			const setHeaderHeight = () => {
				const height = (mainNav as HTMLElement).offsetHeight
				document.documentElement.style.setProperty('--header-height', `${height}px`)
			}
			setHeaderHeight()
			window.addEventListener('resize', setHeaderHeight)
		}

		const closeMobileMenu = () => {
			if (mobileMenu) {
				mobileMenu.style.transform = 'translateY(-100%)'
			}
			// Reset icon to menu state
			const menuIcon = menuButton?.querySelector('.menu-icon')
			const closeIcon = menuButton?.querySelector('.close-icon')
			menuIcon?.classList.remove('rotate-90', 'scale-0', 'opacity-0')
			menuIcon?.classList.add('rotate-0', 'scale-100', 'opacity-100')
			closeIcon?.classList.remove('rotate-0', 'scale-100', 'opacity-100')
			closeIcon?.classList.add('-rotate-90', 'scale-0', 'opacity-0')
		}

		menuButton?.addEventListener('click', () => {
			const currentTransform = mobileMenu?.style.transform || 'translateY(-100%)'
			const isOpen = currentTransform === 'translateY(0%)'
			const menuIcon = menuButton.querySelector('.menu-icon')
			const closeIcon = menuButton.querySelector('.close-icon')

			if (isOpen) {
				closeMobileMenu()
				// Animate to menu icon
				menuIcon?.classList.remove('rotate-90', 'scale-0', 'opacity-0')
				menuIcon?.classList.add('rotate-0', 'scale-100', 'opacity-100')
				closeIcon?.classList.remove('rotate-0', 'scale-100', 'opacity-100')
				closeIcon?.classList.add('-rotate-90', 'scale-0', 'opacity-0')
			} else {
				// Open menu
				if (mobileMenu) {
					mobileMenu.style.transform = 'translateY(0%)'
				}
				// Animate to close icon
				menuIcon?.classList.remove('rotate-0', 'scale-100', 'opacity-100')
				menuIcon?.classList.add('rotate-90', 'scale-0', 'opacity-0')
				closeIcon?.classList.remove('-rotate-90', 'scale-0', 'opacity-0')
				closeIcon?.classList.add('rotate-0', 'scale-100', 'opacity-100')
			}
		})

		// Close mobile menu when clicking navigation links
		const mobileNavLinks = mobileMenu?.querySelectorAll('a')
		mobileNavLinks?.forEach((link) => {
			link.addEventListener('click', () => {
				closeMobileMenu()
			})
		})

		// Logo size animation on scroll (desktop only)
		if (window.innerWidth >= 1024) {
			const logo = document.getElementById('header-logo')

			const observer = new IntersectionObserver(
				(entries) => {
					entries.forEach((entry) => {
						if (logo) {
							if (entry.isIntersecting) {
								// Not sticky - large logo (1.3x)
								logo.classList.remove('lg:h-12')
								logo.classList.add('lg:h-[62px]')
							} else {
								// Sticky - small logo
								logo.classList.remove('lg:h-[62px]')
								logo.classList.add('lg:h-12')
							}
						}
					})
				},
				{ threshold: [1], rootMargin: '-1px 0px 0px 0px' }
			)

			// Observe the top of the page
			const sentinel = document.createElement('div')
			sentinel.style.position = 'absolute'
			sentinel.style.top = '0'
			sentinel.style.height = '1px'
			document.body.prepend(sentinel)
			observer.observe(sentinel)
		}
	})
</script>
